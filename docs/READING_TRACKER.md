# 읽음 트래커 설계 문서 (Study Assist, localStorage-only)

## 1. 목표

현재 블로그 포스트는 “내가 이 글을 읽었는지”를 추적할 수 없다.  
본 문서는 **포스트별 읽음 체크 기능**과, 이를 이용해 **시리즈별 학습률(진행률) 표시**를 구현하기 위한 설계를 정리한다.

핵심 원칙:

- 포스트는 정적(MDX)으로 관리한다.
- 읽음 정보는 **서버에 저장하지 않고 브라우저 localStorage에만 저장**한다. (오버헤드 최소)
- **진도율(스크롤 기반 progress%)은 추적하지 않는다.**
- **회독 수(몇 번 읽었는지)도 저장하지 않는다.**

---

## 2. 결정된 정책 요약

### 2.1 식별자 정책 (슬러그 변경 대응)

- **키는 `slug`가 아니라 `postId`를 사용한다.**
- `postId`는 MDX frontmatter에 추가하는 **짧고 영구적인 ID**이다.
  - 제목/slug는 변경될 수 있으므로 키로 부적절
  - `postId`는 변경하지 않는 것을 규칙으로 한다

### 2.2 사용자 경험(UX) 정책

- 포스트를 “읽었다(봤다)”는 판정은 **사용자가 버튼을 눌러 확정**한다.
- 버튼은 **읽음 여부 토글**로 동작한다. (읽음 ↔ 안 읽음)
- 중복 클릭/중복 요청 방지를 위해 **클릭 후 1초 동안 다시 누를 수 없게(disabled)** 한다.
- 완료 피드백은 습관 체크처럼 **작은 애니메이션**으로 제공한다.
  - 읽음으로 바뀔 때만 “기분 좋은” 체크 애니메이션을 재생한다.

### 2.3 노출 정책(로그인 무관)

- localStorage-only이므로 **로그인 여부와 무관하게 모두에게 표시**할 수 있다.
- 단, 읽음 데이터는 **현재 브라우저(기기)에서만 유지**되며 동기화되지 않는다.

---

## 3. 콘텐츠(정적) 모델: `postId` 추가

### 3.1 MDX frontmatter 확장

각 포스트 파일(`content/**/*.mdx`)의 frontmatter에 아래 필드를 추가한다.

- `postId`: `string` (필수, 영구 ID)

예시:

```mdx
---
title: "..."
date: "2025-..."
postId: "rxt-001"
series: "React Learning"
seriesOrder: 3
tags: ["react"]
---
```

규칙:

- **짧고 안정적인 문자열**(예: `rxt-001`, `math-003`)
- 한 번 발급하면 변경하지 않는다.
- 전체 포스트에서 유일해야 한다(UNIQUE).

### 3.2 Contentlayer 스키마에 `postId` 노출

`contentlayer.config.ts`의 `Post.fields`에 `postId`를 추가하여, 코드에서 `post.postId`로 접근 가능하게 한다.

> “노출”이란: MDX frontmatter의 값을 Contentlayer가 생성하는 `Post` 객체/타입에 포함시키는 것.

---

## 4. 기능 스펙: 포스트 읽음 버튼

### 4.1 UI 형태

- 원형 버튼
- 기본 상태 아이콘: **눈(👁️)**
- 읽음 상태 아이콘: **체크(✓)**
- 버튼 위에 작은 말풍선이 **항상 표시**됨(hover 아님)
  - 안 읽음(`is_read = false`) → `봤나요?`
  - 읽음(`is_read = true`) → `봤어요!`

### 4.2 동작

- 클릭 시:
  - localStorage에 `is_read` 값을 토글한다.
  - UI:
    - 안 읽음: 눈(👁️) + `봤나요?`
    - 읽음: 체크(✓) + `봤어요!`
  - **1초 동안 버튼 disabled**

### 4.3 애니메이션(피드백)

습관 체크 UX와 일관되게 아래 조합을 사용한다.

- 체크 아이콘 전환 시 **체크마크 드로잉 애니메이션** (기존 `drawCheckmark` keyframes 재사용)
- 클릭 순간 말풍선 또는 버튼이 **가볍게 pop(스케일업→복귀)**
  - 권장: “읽음으로 전환될 때”에만 더 강한 피드백(체크 드로잉 + pop)
  - “안 읽음으로 되돌릴 때”는 약한 피드백(색상/opacity 변화 정도)만 적용해도 충분

---

## 5. 데이터 모델(localStorage)

### 5.1 저장 키/스키마

- **localStorage key**: `blog.postReads.v1`
- **저장 값**: JSON 문자열

권장 형태(읽음 여부만 최소 저장):

```json
{
  "v": 1,
  "read": {
    "rxt-001": 1,
    "rxt-002": 1
  }
}
```

의미:

- `read[postId]`가 존재하면 읽음(true), 없으면 안 읽음(false)
- 값 `1`은 존재 여부 표현용(불리언 대신 오브젝트 키 존재로 관리)
- 버전 필드 `v`로 향후 마이그레이션 여지 확보

초기화:

- 전체 초기화: 키 삭제 또는 `{v:1, read:{}}`로 재설정
- 시리즈 초기화: 해당 시리즈의 postId들을 `read`에서 삭제

### 5.2 브라우저 환경 가드

localStorage는 브라우저에서만 가능하므로 아래 규칙을 지킨다.

- 읽기/쓰기는 **클라이언트에서만** 수행한다. (`typeof window !== 'undefined'`)
- Next.js에서 `onClick` 같은 이벤트 핸들러는 서버 컴포넌트에 둘 수 없으므로,
  - 페이지/레이아웃/시리즈 계산(정적 메타)은 **서버 컴포넌트 유지**
  - 읽음 버튼/시리즈 초기화 버튼처럼 “클릭 가능한 UI”만 **클라이언트 컴포넌트(위젯)로 분리**한다.

---

## 6. 시리즈별 학습률 계산 (정적 시리즈 + 런타임 사용자 데이터)

### 6.1 현재 시리즈 로직(정적)

시리즈는 DB에 저장하지 않고, MDX frontmatter(`series`, `seriesOrder`)를 기반으로 런타임에서 묶는다.  
이 값들은 Contentlayer가 빌드 시 생성한 “정적 메타”로부터 얻는다.

### 6.2 학습률(개인화) 정의

시리즈의 포스트 목록을 \(P\)라 할 때:

- **학습률(읽음 기준)**:
  - \( \text{rate} = \frac{|\{p \in P \mid isReadLocal(p.postId) = true\}|}{|P|} \)

### 6.3 구현 책임 분리(권장)

- 서버/정적 영역:
  - 시리즈의 포스트 목록(각 포스트의 `postId` 포함) 제공
  - 기존 `SeriesNav`의 “현재 글 위치 게이지(current/total)” 유지
- 클라이언트:
  - localStorage에서 `postId -> is_read` 맵을 만든다
  - 위 정의에 따라 시리즈별 학습률을 계산하여 표시한다

---

## 8. 범위(이번 미션)

### 8.1 포함

- `postId` 정책 도입(문서화 + Contentlayer 필드 확장 + MDX frontmatter 적용)
- 포스트 상세 페이지에 “봤나요?/봤어요!” 읽음 토글 버튼 추가
- 버튼 애니메이션(체크마크 드로잉 + pop)
- (선택) 시리즈 카드에 “내 학습률” 게이지 추가
- (선택) 시리즈별 학습 현황 UI에 “초기화” 버튼 추가 (해당 시리즈의 모든 읽음 정보를 초기화)

### 8.2 제외(영구)

- 스크롤 기반 진도율(progress%) 추적
- 스크롤 기반 완독 자동 판정
- 진동(햅틱)

---

## 9. 오픈 이슈(결정 필요)

- “안 읽음” 상태의 말풍선 문구:
  - `봤나요?`(채택) vs `읽어볼까요?`
- “안 읽음으로 되돌리기” 허용 여부:
  - 허용(토글) vs 1회 읽음 이후 고정
- 시리즈 학습률 표시 위치:
  - `SeriesNav` 내부 하단 vs 별도 대시보드 페이지
- 시리즈 “초기화” 버튼 위치:
  - `SeriesNav` 내부(시리즈 단위 카드) vs 별도 학습 현황 페이지

---

## 10. 시리즈 단위 초기화(Reset)

### 10.1 요구사항

사용자는 시리즈를 한 번 다 읽은 뒤, 다음 번 학습 때 “내가 어디까지 학습했는지”를 다시 측정하고 싶을 수 있다.  
이를 위해 **시리즈별 학습 현황 UI에 `초기화` 버튼**을 제공한다.

### 10.2 동작 정의

- 버튼 클릭 시:
  - 해당 시리즈에 포함된 모든 포스트의 읽음 상태를 localStorage에서 해제한다.
  - UI의 학습률 게이지가 즉시 0%로 갱신된다.

### 10.3 구현 방식(권장)

시리즈는 정적 메타에서 계산되므로, “이 시리즈의 postId 목록”은 프론트에서 얻을 수 있다.

- 클라이언트에서:
  - `seriesPosts: Post[]`를 확보하고 `postIds = seriesPosts.map(p => p.postId)`를 만든다.
  - localStorage의 `read` 오브젝트에서 해당 `postIds` 키를 삭제 후 저장한다.

