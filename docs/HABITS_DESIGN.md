# 습관 관리 기능 설계 문서

## 1. 프로젝트 개요

### 1.1 목표
기존 Flutter 앱 `doit_everyday`를 웹 버전으로 업그레이드하여 Next.js 블로그와 통합된 습관 관리 플랫폼 구축

### 1.2 기존 앱 분석

- **플랫폼**: Flutter (Android)
- **데이터 저장**: SQLite (로컬)
- **주요 기능**: 습관 등록, 완료 체크, 통계, 달력 뷰
- **제한사항**: 오프라인 전용, 단일 기기, 동기화 불가

## 2. 업그레이드 목표

### 2.1 핵심 개선사항

1. **클라우드 동기화**: Supabase를 통한 다기기 동기화
2. **웹 접근성**: 브라우저에서 접근 가능
3. **블로그 통합**: 랜딩 페이지에서 바로 접근
4. **향상된 UX**: 모던한 웹 UI/UX 적용

### 2.2 유지할 기능

- 습관 등록 및 관리
- 요일별 수행 설정
- 완료 체크
- 통계 및 달력 뷰
- 연속 달성 일수 추적

### 2.3 추가할 기능

**핵심 기능:**

- 사용자 인증 (Supabase Auth)
- 실시간 동기화
- 습관 수정/삭제
- 습관 공유 (향후)
- 알림 기능 (향후)

**게이미피케이션 및 동기부여 요소:**

- 스트릭 시각화 (연속 달성 체인)
- 배지/업적 시스템
- 레벨/경험치 시스템
- 목표 설정 및 달성률 추적
- 습관 템플릿
- 통계 대시보드 강화
- 주간/월간 리포트
- 검색 기능 (향후)

## 3. 기능 스펙

### 3.1 습관 등록 (`/habits/create`)

**입력 항목:**

- 제목 (필수, 텍스트)
- 시작일 (필수, 날짜)
- 종료일 (필수, 날짜)
- 수행 요일 (필수, 다중 선택: 월~일)
- 색상 (선택, 색상 피커)

**검증 규칙:**

- 제목: 1~50자
- 시작일 ≤ 종료일
- 최소 1개 요일 선택
- 종료일은 오늘부터 최대 3년 후까지

**UI 구성:**

- 폼 레이아웃 (카드 형태)
- 날짜 선택기 (Date Range Picker)
- 요일 체크박스 그리드
- 색상 선택 버튼
- 저장/취소 버튼

### 3.2 습관 목록 (`/habits`)

**디자인 철학:**

- 습관은 평생 지켜야 하는 것 → 너무 많이 만들지 않도록 유도
- 웹은 모바일보다 화면이 크지만, 집중력을 해치지 않아야 함
- 한 번에 하나만 보는 것보다 효율적이면서도 집중할 수 있는 균형 필요

**표시 방식: 반응형 레이아웃 (제안 및 분석)**

**사용자 요구사항:**

- 습관은 평생 지켜야 하는 것 → 최대 10개로 제한
- 기존 앱: 모바일에서 슬라이드로 하나씩 보여줌
- 웹 버전: 더 효율적으로 조망하면서도 집중력 유지

**전문가 분석 및 제안:**

**옵션 A: 모바일 1열 (기존 앱 유지)**

- 장점: 집중력 최대, 기존 사용자 친숙함
- 단점: 여러 습관 파악 어려움, 스와이프 동작 필요
- 평가: 습관이 적으면(3-5개) 충분하지만, 7-10개면 불편할 수 있음

**옵션 B: 모바일 2열 그리드 (추천)**

- 장점:
  - 한눈에 2개 습관 파악 가능 (스크롤 없이)
  - 스와이프 없이도 모든 습관 확인 가능
  - 완료/미완료 상태 비교 용이
- 단점: 카드가 작아질 수 있음 (하지만 습관이 적으므로 충분)
- 평가: 습관이 5-10개일 때 가장 효율적

**옵션 C: 하이브리드 (추천)**

- 모바일: 2열 그리드 기본, 옵션으로 "집중 모드" (1열)
- 사용자가 선택 가능
- 평가: 유연성과 효율성 균형

**최종 제안: 옵션 C (하이브리드) 또는 옵션 B (2열 그리드)**

**이유:**

1. 습관이 적으면(5-10개) 2열로도 충분히 집중 가능
2. 웹 버전의 장점(여러 정보 동시 파악) 활용
3. 스와이프 없이도 모든 습관 확인 가능 (UX 개선)
4. 완료된 습관을 바로 확인하고 다음 습관으로 넘어가기 편함
5. (옵션 C) 사용자 선호도에 따라 선택 가능

**반응형 레이아웃 (화면 비율 및 방향 기반 최적화):**

**전문가 분석:**

- 화면 비율과 방향에 따라 최적 레이아웃이 달라짐
- 각 환경의 장점을 극대화하는 것이 중요

**최종 제안 (화면 비율 기반):**

**1. 모바일 세로 (portrait, < 768px, 세로 > 가로)**

- **1열 레이아웃** (기존 앱과 유사)
- 이유: 가로가 짧아서 2열로 나누면 카드가 너무 작아짐
- 스와이프 또는 스크롤로 습관 이동
- 집중력 최대화

**2. 모바일 가로 (landscape, < 768px, 가로 > 세로)**

- **2열 그리드**
- 이유: 가로가 길어져서 2열이 가능하고 효율적
- 한눈에 2개 습관 파악 가능

**3. 태블릿 세로 (portrait, 768px ~ 1024px, 세로 > 가로)**

- **2열 그리드**
- 이유: 화면이 충분히 커서 2열이 적합
- 카드 크기도 충분히 큼

**4. 태블릿 가로 (landscape, 768px ~ 1024px, 가로 > 세로)**

- **3열 그리드**
- 이유: 가로가 길어서 3열이 가능
- 여러 습관을 효율적으로 관리

**5. 데스크톱 (> 1024px)**

- **3-4열 그리드** (화면 너비에 따라)
- 이유: 가로가 매우 길어서 더 많은 열 활용 가능
- 습관이 적으므로(5-10개) 4열까지도 가능

**구현 방법:**

- CSS Media Queries: `width`, `height`, `orientation` 활용
- `@media (orientation: portrait)` / `@media (orientation: landscape)`
- 화면 비율(`aspect-ratio`)도 고려 가능

**장점:**

- 각 환경에서 최적의 UX 제공
- 화면 공간을 효율적으로 활용
- 사용자 경험 개선

**토글 기능: 체크 화면 ↔ 달력 뷰**

- 기본 화면: 습관 체크하기 (각 습관 카드에 완료 체크)
- 토글 버튼: 우측 상단 또는 헤더에 배치
- 달력 뷰: 모든 습관의 종합 성공률을 날짜별로 표시
  - 각 날짜에 원형 파이차트로 성공률 표시
  - 성공률 계산: (완료된 습관 수 / 해당 날짜에 수행해야 할 습관 수) × 100
  - 예: 5개 습관 중 4개 완료 = 80%, 2개 습관만 해야 하는 날에 1개만 = 50%
  - 비주얼: 원형 파이차트 (SVG Circle 또는 라이브러리 사용)

**각 습관 카드 구성:**

- 제목 (큰 글씨)
- 설명 (작은 글씨, 선택)
- 색상 인디케이터 (왼쪽 테두리 또는 배경)
- 완료 체크박스 (큰 버튼)
- 연속 달성 일수 (작은 배지: 🔥7)

**표시 정보:**

- 오늘 수행해야 할 습관 목록 (우선)
- 습관 카드: 제목, 색상, 완료 체크박스
- 연속 달성 일수 (작은 배지 형태: 🔥7)
- 완료율 (선택, 작게 표시)

**인터랙션:**

- 카드 클릭 → 상세 페이지 이동
- 완료 체크박스 → 즉시 완료 처리, 카드가 흐리게 변하거나 하단으로 이동
- 추가 버튼 → 등록 페이지 이동 (습관 개수 제한 경고 표시)
- 토글 버튼 → 체크 화면 ↔ 달력 뷰 전환

**습관 개수 제한:**

- 최대 습관 개수: 7개 (또는 10개)
- 제한 도달 시 추가 버튼 비활성화 또는 경고 메시지
- "습관은 평생 지켜야 합니다. 너무 많으면 지키기 어렵습니다" 안내

**종합 달력 뷰 (토글 기능):**

- **목적**: 모든 습관의 종합 현황을 한눈에 파악
- **위치**: 습관 목록 화면에서 토글 버튼으로 전환
- **표시 방식**:
  - 달력 그리드 (월별 표시)
  - 각 날짜에 원형 파이차트로 성공률 표시
  - 성공률 = (완료된 습관 수 / 해당 날짜에 수행해야 할 습관 수) × 100
- **계산 로직**:

  ```
  해당 날짜에 수행해야 할 습관 수 = habits.filter(h => 
    h.weekdays.includes(해당날짜의요일) && 
    h.start_date <= 날짜 && 
    h.end_date >= 날짜
  ).length
  
  완료된 습관 수 = habit_records.filter(r => 
    r.date === 날짜 && 
    r.completed === true
  ).length
  
  성공률 = (완료된 습관 수 / 수행해야 할 습관 수) × 100
  ```

- **비주얼 디자인**:
  - 원형 파이차트 (SVG Circle 사용)
  - 성공률에 따라 색상 변화 (예: 100% = 초록, 50% = 노랑, 0% = 회색)
  - 호버 시 툴팁으로 상세 정보 표시 (예: "5개 중 4개 완료 (80%)")
- **예시**:
  - 5개 습관 중 4개 완료 = 80% (원형 차트 80% 채워짐)
  - 2개 습관만 해야 하는 날에 1개만 = 50% (원형 차트 50% 채워짐)
  - 모든 습관 완료 = 100% (원형 차트 완전히 채워짐)

### 3.3 습관 상세 (`/habits/[id]`)

**표시 정보:**

- 습관 제목
- 기간 (시작일 ~ 종료일)
- 수행 요일
- 완료 횟수 / 총 일수
- 완료율 (%)
- 현재 연속 달성 일수 / 최대 연속 달성 일수
- 달력 뷰 (성공/실패 표시)

**액션:**

- 수정 버튼 → 수정 모달/페이지
- 삭제 버튼 → 확인 후 삭제
- 달력에서 날짜 클릭 → 완료/미완료 토글

**달력 뷰 (해당 습관만):**

- 성공: 초록색 표시 또는 체크마크
- 실패: 회색 또는 X 표시
- 오늘: 강조 표시
- 미래 날짜: 비활성화
- **참고**: 습관 상세 화면의 달력은 해당 습관만의 성공/실패를 표시 (종합 달력과 다름)

### 3.4 습관 수정

**수정 가능 항목:**

- 제목
- 시작일 (단, 이미 기록된 날짜가 있으면 제한)
- 종료일
- 수행 요일
- 색상

**제약사항:**

- 시작일을 늦추면 기존 기록과 충돌 가능 → 경고 표시
- 종료일을 앞당기면 미래 기록 삭제 → 확인 필요

### 3.5 통계 대시보드 (향후)

**표시 항목:**

- 전체 완료율
- 주간/월간 완료율
- 가장 오래 지속한 습관
- 가장 성공률 높은 습관
- 습관별 완료율 차트

## 4. 화면 설계

### 4.1 디자인 원칙

**기존 앱 분석:**

- 분홍, 보라, 연두 그라데이션 과다 사용
- `Colors.orange.shade50` → `Colors.pink.shade100` 그라데이션
- `Colors.lightBlue` → `Colors.greenAccent` 그라데이션
- CarouselSlider로 슬라이드 방식
- 큰 체크 아이콘 (150px)

**새로운 웹 버전 디자인 방향:**

**1. 색상 시스템:**

- 그라데이션 완전 제거 → 단색 + 미묘한 그림자
- Vercel 스타일: 순수 검은색/흰색 배경
- 습관별 색상: 사용자가 선택 (왼쪽 테두리 또는 배경)
- 액센트 색상: 무채색 계열 (회색)로 통일

**2. 모바일 터치 피드백 (쫀득한 재미):**

- 완료 체크 시: 스프링 애니메이션 (scale + bounce)
- 카드 탭 시: 미묘한 눌림 효과 (scale 0.98)
- 스와이프 시: 부드러운 전환 (framer-motion)
- 완료 시: 축하 애니메이션 (confetti 효과 또는 체크마크 애니메이션)
- 햅틱 피드백: 진동 (모바일 브라우저 지원 시)

**3. 인터랙션 디자인:**

- 완료 버튼: 큰 원형 버튼 (모바일 최소 60px)
- 완료 시: 체크마크가 그려지는 애니메이션
- 연속 달성 시: 불꽃 이모지가 나타나는 애니메이션
- 카드 호버: 미묘한 그림자 증가 + 살짝 올라옴

**4. 타이포그래피:**

- 제목: 큰 글씨 (모바일 24px, 데스크톱 32px)
- 설명: 작은 글씨 (14px)
- Geist 폰트 유지

**5. 레이아웃:**

- 카드: 충분한 패딩 (모바일 24px, 데스크톱 32px)
- 여백: 충분한 공간 (카드 간 16-24px)
- 모바일 세로: 1열, 가로: 2열
- 태블릿: 2-3열
- 데스크톱: 3-4열

**6. 애니메이션:**

- 트랜지션: `cubic-bezier(0.34, 1.56, 0.64, 1)` (스프링 느낌)
- 완료 애니메이션: 0.3s
- 카드 전환: 0.2s
- 부드럽고 쫀득한 느낌

### 4.2 레이아웃 구조

**모바일 (< 768px):**

```
/habits
├── 헤더 (제목: "습관 관리", 추가 버튼)
├── 습관 카드 (전체 화면, 하나씩)
│   ├── 색상 인디케이터 (왼쪽 테두리)
│   ├── 제목 (큰 글씨)
│   ├── 설명 (작은 글씨, 선택)
│   ├── 완료 체크박스 (큰 버튼)
│   ├── 연속 달성 일수 (🔥7)
│   └── 인디케이터 (1/5)
├── 스와이프 제스처 (좌우)
└── 빈 상태 (습관이 없을 때)
```

**태블릿/데스크톱 (≥ 768px):**

```
/habits
├── 헤더 (제목: "습관 관리", 추가 버튼)
├── 습관 카드 그리드 (2-3열)
│   ├── 습관 카드 1 (미완료, 상단)
│   │   ├── 색상 인디케이터
│   │   ├── 제목
│   │   ├── 설명
│   │   ├── 완료 체크박스
│   │   └── 연속 달성 일수
│   ├── 습관 카드 2 (미완료)
│   └── 습관 카드 3 (완료, 흐리게 또는 하단)
└── 빈 상태 (습관이 없을 때)
```

### 4.3 컴포넌트 구조

```
components/habits/
├── HabitCard.tsx          # 습관 카드 (반응형, 터치 피드백)
├── HabitList.tsx           # 습관 목록 (그리드/스와이프)
├── HabitSwipeView.tsx      # 모바일 스와이프 뷰 (framer-motion)
├── HabitGridView.tsx        # 태블릿/데스크톱 그리드 뷰
├── HabitForm.tsx           # 습관 등록/수정 폼
├── HabitDetail.tsx          # 습관 상세
├── HabitCalendar.tsx        # 습관 상세 달력 뷰 (해당 습관만)
├── OverallCalendar.tsx     # 종합 달력 뷰 (모든 습관의 성공률)
├── CalendarDay.tsx          # 달력 날짜 셀 (원형 파이차트 포함)
├── HabitStats.tsx           # 통계 표시
├── WeekdaySelector.tsx      # 요일 선택기
├── ColorPicker.tsx          # 색상 선택기
└── CompletionButton.tsx     # 완료 버튼 (애니메이션 포함)
```

### 4.4 디자인 상세 스펙

**기존 앱 분석:**

- 분홍, 보라, 연두 그라데이션 과다 사용
- `Colors.orange.shade50` → `Colors.pink.shade100` 그라데이션
- `Colors.lightBlue` → `Colors.greenAccent` 그라데이션
- CarouselSlider로 슬라이드 방식
- 큰 체크 아이콘 (150px)

**새로운 웹 버전 디자인 방향:**

**1. 색상 시스템:**

- 그라데이션 완전 제거 → 단색 + 미묘한 그림자
- Vercel 스타일: 순수 검은색/흰색 배경
- 습관별 색상: 사용자가 선택 (왼쪽 테두리 4px 또는 배경)
- 액센트 색상: 무채색 계열 (회색)로 통일

**2. 모바일 터치 피드백 (쫀득한 재미):**

- 완료 체크 시: 스프링 애니메이션 (`scale(0.95)` → `scale(1.1)` → `scale(1)`)
- 카드 탭 시: 미묘한 눌림 효과 (`scale(0.98)`, 0.15s)
- 스와이프 시: 부드러운 전환 (framer-motion)
- 완료 시: 체크마크 그려지는 애니메이션 (SVG path animation, 0.3s)
- 연속 달성 시: 불꽃 이모지 나타남 (0.5s)
- (선택) 햅틱 피드백: 진동 (모바일 브라우저 지원 시)

**3. 인터랙션 디자인:**

- 완료 버튼: 큰 원형 버튼 (모바일 최소 60px, 데스크톱 80px)
- 완료 시: 체크마크가 그려지는 애니메이션
- 카드 호버: 미묘한 그림자 증가 + 살짝 올라옴 (`translateY(-2px)`)

**4. 애니메이션 타이밍:**

- 완료 애니메이션: 0.3s `cubic-bezier(0.34, 1.56, 0.64, 1)` (스프링 느낌)
- 카드 전환: 0.2s `ease-out`
- 호버 효과: 0.15s `ease`

**5. 타이포그래피:**

- 제목: 큰 글씨 (모바일 24px, 데스크톱 32px)
- 설명: 작은 글씨 (14px)
- Geist 폰트 유지

**6. 레이아웃:**

- 카드: 충분한 패딩 (모바일 24px, 데스크톱 32px)
- 여백: 충분한 공간 (카드 간 16-24px)
- 모바일 세로: 1열, 가로: 2열
- 태블릿: 2-3열
- 데스크톱: 3-4열

## 5. 데이터베이스 설계

### 5.1 테이블 구조

#### `habits` 테이블

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ------ | -----|--------- | ---- |
| id | UUID | PRIMARY KEY | 습관 고유 ID |
| user_id | UUID | NOT NULL, FK → auth.users | 사용자 ID |
| title | TEXT | NOT NULL | 습관 제목 |
| description | TEXT | | 습관 설명 (선택) |
| color | TEXT | NOT NULL | 색상 코드 (hex) |
| start_date | DATE | NOT NULL | 시작일 |
| end_date | DATE | NOT NULL | 종료일 |
| weekdays | INTEGER[] | NOT NULL | 수행 요일 배열 [1,2,3,4,5] |
| priority | INTEGER | DEFAULT 0 | 우선순위 (낮을수록 높음, 향후 사용) |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 생성일시 |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 수정일시 |

**제약조건:**

- 사용자당 최대 습관 개수: 10개 (애플리케이션 레벨에서 체크)

**인덱스:**

- `user_id` (조회 성능)
- `user_id, start_date, end_date` (복합 인덱스, 기간 조회)

#### `habit_records` 테이블

| 컬럼명 | 타입 | 제약조건 | 설명 |
|--------|------|----------|------|
| id | UUID | PRIMARY KEY | 기록 고유 ID |
| habit_id | UUID | NOT NULL, FK → habits | 습관 ID |
| date | DATE | NOT NULL | 기록 날짜 |
| completed | BOOLEAN | NOT NULL, DEFAULT false | 완료 여부 |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 생성일시 |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 수정일시 |

**제약조건:**

- UNIQUE(habit_id, date) - 같은 습관의 같은 날짜는 중복 불가

**인덱스:**

- `habit_id` (조회 성능)
- `habit_id, date` (복합 인덱스, 날짜별 조회)

### 5.2 RLS (Row Level Security) 정책

**habits 테이블:**

- SELECT: 자신의 습관만 조회 가능
- INSERT: 자신의 습관만 생성 가능
- UPDATE: 자신의 습관만 수정 가능
- DELETE: 자신의 습관만 삭제 가능

**habit_records 테이블:**

- SELECT: 자신의 습관의 기록만 조회 가능
- INSERT: 자신의 습관의 기록만 생성 가능
- UPDATE: 자신의 습관의 기록만 수정 가능
- DELETE: 자신의 습관의 기록만 삭제 가능

### 5.3 계산 필드 (클라이언트 사이드)

**통계 계산:**

- 완료 횟수: `COUNT(*) WHERE completed = true`
- 총 일수: 기간 내 요일별 날짜 개수
- 완료율: `(완료 횟수 / 총 일수) * 100`
- 연속 달성 일수: 최근 날짜부터 연속으로 `completed = true`인 개수
- 최대 연속 달성 일수: 전체 기간 중 최대 연속 일수

## 6. API 설계

### 6.1 습관 CRUD

```typescript
// 습관 목록 조회
GET /api/habits
Query: ?filter=active|all|completed&sort=latest|oldest|rate|streak

// 습관 상세 조회
GET /api/habits/[id]

// 습관 생성
POST /api/habits
Body: { title, color, start_date, end_date, weekdays }

// 습관 수정
PATCH /api/habits/[id]
Body: { title?, color?, start_date?, end_date?, weekdays? }

// 습관 삭제
DELETE /api/habits/[id]
```

### 6.2 기록 CRUD

```typescript
// 기록 조회 (습관별, 날짜 범위)
GET /api/habits/[id]/records
Query: ?start_date=YYYY-MM-DD&end_date=YYYY-MM-DD

// 기록 생성/수정 (완료 체크)
POST /api/habits/[id]/records
Body: { date: YYYY-MM-DD, completed: boolean }

// 기록 삭제
DELETE /api/habits/[id]/records/[date]
```

### 6.3 통계 조회

```typescript
// 습관 통계
GET /api/habits/[id]/stats
Response: {
  total_days: number,
  completed_days: number,
  completion_rate: number,
  current_streak: number,
  max_streak: number
}
```

## 7. 기술 스택

### 7.1 프론트엔드

- Next.js 16 (App Router)
- React 19
- TypeScript
- Tailwind CSS 4
- Supabase JS Client

### 7.2 백엔드

- Supabase (PostgreSQL)
- Supabase Auth
- Row Level Security (RLS)

### 7.3 상태 관리

- React Server Components (기본)
- React Hooks (로컬 상태)
- Supabase Realtime (향후 동기화)

## 8. 구현 단계

### Phase 1: 인프라 구축

1. ✅ Supabase 프로젝트 생성
2. ✅ 환경 변수 설정
3. ✅ 데이터베이스 테이블 생성
4. ✅ RLS 정책 설정
5. ✅ user_stats 자동 생성 트리거 설정
6. ✅ Google OAuth Provider 설정
7. ✅ GitHub OAuth Provider 설정

### Phase 2: 인증 시스템 (우선순위: 최우선)

**상태**: ✅ 완료

**참고 문서**: `docs/HABITS_AUTH.md`에 상세한 인증 시스템 설계가 정리되어 있습니다.

**완료된 작업**:

1. ✅ AuthProvider 구현 (인증 상태 관리)
2. ✅ 로그인 페이지 (`/auth/login`) - 구글/깃허브 소셜 로그인
3. ~~회원가입 페이지~~ (소셜 로그인으로 대체)
4. ✅ ProtectedRoute 컴포넌트 (보호된 라우트)
5. ✅ 헤더 톱니바퀴 아이콘 (인증 상태에 따라 표시)
6. ✅ 프로필 페이지 (`/profile`) - 로그아웃 버튼
7. ✅ user_stats 초기화 (Database Trigger)
8. ✅ Hydration 에러 수정

### Phase 3: 습관 관리 핵심 기능

1. ✅ 습관 등록 폼
2. ✅ 습관 목록 화면
   - ✅ 습관 카드 컴포넌트
   - ✅ 완료 체크 기능
   - ✅ 토글 버튼 (체크 화면 ↔ 달력 뷰)
   - ✅ 종합 달력 뷰 (모든 습관의 성공률 표시, 원형 파이차트, 달성률 텍스트 표시)
3. ✅ 습관 상세 화면
   - ✅ 해당 습관만의 달력 뷰 (성공/실패 표시)
   - ✅ 통계 계산 및 표시 (완료율, 완료 일수, 연속 달성 일수)
   - ✅ 삭제 기능 (수정 기능은 별도 페이지로 구현 예정)

### Phase 5: 최적화 및 개선

1. ⏳ 성능 최적화
2. ⏳ 오프라인 지원 (향후)
3. ⏳ 알림 기능 (향후)

## 9. 참고사항

### 9.1 기존 앱과의 차이점

- **데이터 저장**: SQLite → Supabase PostgreSQL
- **동기화**: 없음 → 실시간 동기화
- **인증**: 없음 → Supabase Auth
- **플랫폼**: 모바일 앱 → 웹 앱

### 9.2 마이그레이션 고려사항

- 기존 앱 사용자 데이터 마이그레이션 기능 (향후)
- CSV/JSON 내보내기 기능 (향후)

### 9.3 확장 가능성

- 습관 공유 기능
- 커뮤니티 기능
- 습관 템플릿
- 목표 설정 및 달성 배지

## 10. 게이미피케이션 및 동기부여 요소

### 10.1 스트릭 시각화 (연속 달성 체인)

**목표**: 연속 달성을 시각적으로 강조하여 지속 동기부여

**구현 방법:**

- 습관 카드에 연속 달성 일수 표시 (불꽃 이모지 🔥)
- 달력 뷰에서 연속 달성 체인 시각화
- 연속 달성 일수에 따른 색상 변화 (1일: 회색 → 7일: 노란색 → 30일: 금색)
- 연속 달성 기록 깨짐 시 경고 표시

**UI 예시:**

```
[습관 카드]
제목: 매일 운동하기
🔥 연속 7일 달성!
[체크박스]
```

### 10.2 배지/업적 시스템

**목표**: 특정 목표 달성 시 배지 획득으로 성취감 제공

**배지 종류:**

- **초보자**: 첫 습관 등록
- **꾸준함**: 7일 연속 달성
- **불굴의 의지**: 30일 연속 달성
- **완벽주의자**: 한 달 동안 100% 완료율
- **다작가**: 습관 10개 등록
- **장기 러너**: 100일 연속 달성
- **주간 완벽주의자**: 한 주 동안 모든 습관 완료
- **월간 완벽주의자**: 한 달 동안 모든 습관 완료

**구현 방법:**

- `user_achievements` 테이블 생성
- 배지 획득 시 알림 표시
- 프로필 페이지에 배지 컬렉션 표시
- 배지별 설명 및 획득 조건 표시

### 10.3 레벨/경험치 시스템

**목표**: 습관 완료 시 경험치 획득으로 레벨업 시스템

**경험치 계산:**

- 습관 완료: +10 XP
- 연속 달성 보너스: 연속 일수 × 2 XP
- 주간 완벽 달성: +50 XP
- 월간 완벽 달성: +200 XP

**레벨 시스템:**

- 레벨 1: 0-100 XP
- 레벨 2: 100-300 XP
- 레벨 3: 300-600 XP
- 레벨 4: 600-1000 XP
- 레벨 5: 1000-1500 XP
- ... (레벨업당 필요 경험치 증가)

**UI 표시:**

- 헤더에 현재 레벨 및 경험치 바 표시
- 레벨업 시 축하 애니메이션
- 다음 레벨까지 남은 경험치 표시

### 10.4 목표 설정 및 달성률 추적

**목표 종류:**

- **완료율 목표**: "이번 달 80% 이상 달성"
- **연속 일수 목표**: "30일 연속 달성하기"
- **총 완료 횟수 목표**: "100번 완료하기"
- **주간 목표**: "이번 주 모든 습관 완료"

**구현 방법:**

- 습관 등록 시 목표 설정 옵션 추가
- 목표 달성률 실시간 표시
- 목표 달성 시 축하 메시지 및 배지
- 목표 미달성 시 격려 메시지

**UI 예시:**

```
[습관 상세]
목표: 30일 연속 달성
진행률: ████████░░░░░░░░░░ 40% (12/30일)
```

### 10.5 습관 카테고리 (재검토 필요)

**카테고리의 잠재적 가치:**

1. **필터링**: 습관이 많을 때 (20개 이상) 관련 습관만 보기
2. **통계**: 카테고리별 성과 파악 ("건강 습관은 잘 하고 있지만 학습 습관은...")
3. **시각적 구분**: 비슷한 습관을 묶어서 인식

**하지만 실제로:**

- **습관이 적으면 (5-10개)**: 카테고리 불필요, 오히려 선택 부담만 증가
- **필터링보다 검색/정렬**: 더 유연하고 직관적
- **카테고리별 통계**: 흥미롭지만 필수는 아님
- **이미 색상으로 구분**: 시각적 구분은 색상으로 충분

**더 나은 대안:**

1. **색상으로 시각적 구분** (이미 구현 예정)
   - 건강: 초록색
   - 학습: 파란색
   - 자기계발: 보라색
   - 생활: 주황색

2. **검색 기능**
   - 습관 제목으로 검색
   - 더 유연하고 직관적

3. **태그 시스템** (향후, 더 유연함)
   - 하나의 습관에 여러 태그 가능
   - 카테고리보다 더 유연한 분류

**결론:**

- **초기 버전에서는 제외**: 복잡도만 증가, 명확한 가치 부족
- **향후 필요 시 추가**: 사용자 피드백 후 결정
- **대신**: 색상 선택 강화, 검색 기능 추가

### 10.6 습관 템플릿

**목표**: 인기 습관을 템플릿으로 제공하여 등록 편의성 향상

**템플릿 종류:**

- 매일 물 2L 마시기
- 매일 30분 운동하기
- 매일 독서 30분
- 매일 코딩 1시간
- 매일 명상 10분
- 주 3회 헬스장 가기

**기능:**

- 템플릿 선택 시 기본 설정 자동 입력
- 사용자 정의 템플릿 저장
- 템플릿 공유 (향후)

### 10.7 통계 대시보드 강화

**목표**: 종합적인 통계로 성과 파악 및 동기부여

**표시 항목:**

- **전체 통계**:
  - 총 습관 개수
  - 총 완료 횟수
  - 평균 완료율
  - 총 연속 달성 일수
  - 현재 레벨 및 경험치

- **기간별 통계**:
  - 오늘 완료율
  - 이번 주 완료율
  - 이번 달 완료율
  - 올해 완료율

- **습관별 통계**:
  - 가장 성공한 습관 (완료율 높음)
  - 가장 오래 지속한 습관 (연속 일수)
  - 개선이 필요한 습관 (완료율 낮음)

- **시각화**:
  - 주간/월간 완료율 차트
  - 습관별 완료율 비교 차트
  - 연속 달성 일수 그래프
  - 시간대별 완료 패턴 (향후)

### 10.8 주간/월간 리포트

**목표**: 정기적인 리포트로 성과 리뷰 및 동기부여

**리포트 내용:**

- **주간 리포트**:
  - 이번 주 완료한 습관 개수
  - 이번 주 완료율
  - 이번 주 획득한 배지
  - 다음 주 목표 제안

- **월간 리포트**:
  - 이번 달 완료한 습관 개수
  - 이번 달 완료율
  - 이번 달 획득한 배지
  - 이번 달 레벨업 횟수
  - 다음 달 목표 제안
  - 성장 그래프

**구현 방법:**

- 매주/매월 자동 리포트 생성
- 리포트 페이지 (`/habits/reports`)
- 리포트 공유 기능 (향후)

### 10.9 알림 및 리마인더

**목표**: 습관 수행을 놓치지 않도록 알림 제공

**알림 종류:**

- **일일 리마인더**: 습관 수행 시간 알림
- **미완료 알림**: 하루 종료 전 미완료 습관 알림
- **스트릭 경고**: 연속 달성 기록이 깨질 위험 시 알림
- **목표 달성 알림**: 목표 달성 시 축하 알림
- **레벨업 알림**: 레벨업 시 축하 알림

**구현 방법:**

- 브라우저 알림 API 사용
- 습관별 알림 시간 설정
- 알림 설정 페이지 (`/habits/settings/notifications`)

### 10.10 소셜 기능 (향후)

**목표**: 다른 사용자와의 경쟁 및 공유로 동기부여

**기능:**

- 습관 공유 (공개/비공개 설정)
- 친구 추가 및 비교
- 리더보드 (주간/월간)
- 습관 챌린지 참여
- 커뮤니티 게시판

## 11. 데이터베이스 확장 (게이미피케이션)

### 11.1 추가 테이블

#### `user_stats` 테이블

| 컬럼명 | 타입 | 제약조건 | 설명 |
|--------|------|----------|------|
| id | UUID | PRIMARY KEY | 통계 고유 ID |
| user_id | UUID | NOT NULL, FK → auth.users | 사용자 ID |
| total_xp | INTEGER | NOT NULL, DEFAULT 0 | 총 경험치 |
| current_level | INTEGER | NOT NULL, DEFAULT 1 | 현재 레벨 |
| total_habits | INTEGER | NOT NULL, DEFAULT 0 | 총 습관 개수 |
| total_completions | INTEGER | NOT NULL, DEFAULT 0 | 총 완료 횟수 |
| longest_streak | INTEGER | NOT NULL, DEFAULT 0 | 최장 연속 달성 일수 |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 수정일시 |

#### `achievement_definitions` 테이블 (배지 정의)

| 컬럼명 | 타입 | 제약조건 | 설명 |
|--------|------|----------|------|
| id | UUID | PRIMARY KEY | 배지 정의 고유 ID |
| code | TEXT | NOT NULL, UNIQUE | 배지 코드 (badge_7days, badge_30days 등) |
| name | TEXT | NOT NULL | 배지 이름 |
| description | TEXT | NOT NULL | 배지 설명 |
| icon_type | TEXT | NOT NULL, DEFAULT 'emoji' | 아이콘 타입 (emoji, svg, image_url) |
| icon_value | TEXT | NOT NULL | 아이콘 값 (이모지, SVG 코드, 이미지 URL) |
| condition_type | TEXT | NOT NULL | 조건 타입 (streak_days, completion_rate, total_completions 등) |
| condition_value | INTEGER | NOT NULL | 조건 값 |
| is_active | BOOLEAN | NOT NULL, DEFAULT true | 활성화 여부 |
| display_order | INTEGER | NOT NULL, DEFAULT 0 | 표시 순서 |
| created_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 생성일시 |
| updated_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 수정일시 |

**배지 아이콘 관리 전략:**

- **1단계 (초기)**: 이모지 사용 (🎯, 🔥, ⭐, 🏆, 💪, 📚 등)
  - 장점: 이미지 저장 불필요, 빠른 구현, 무료
  - 단점: 커스터마이징 제한
- **2단계 (향후)**: SVG 아이콘 또는 Supabase Storage 사용
  - SVG: 코드로 저장 가능, 확장성 좋음
  - 이미지: Supabase Storage (무료 플랜 1GB)

#### `user_achievements` 테이블 (사용자 배지 획득 기록)

| 컬럼명 | 타입 | 제약조건 | 설명 |
|--------|------|----------|------|
| id | UUID | PRIMARY KEY | 업적 고유 ID |
| user_id | UUID | NOT NULL, FK → auth.users | 사용자 ID |
| achievement_id | UUID | NOT NULL, FK → achievement_definitions | 배지 정의 ID |
| earned_at | TIMESTAMPTZ | NOT NULL, DEFAULT now() | 획득일시 |
| metadata | JSONB | | 업적 관련 추가 정보 (습관 ID, 달성 수치 등) |

**habits 테이블 확장:**

- `description` (TEXT, nullable) - 습관 설명 (선택)
- `priority` (INTEGER, DEFAULT 0) - 우선순위 (낮을수록 높음, 향후 사용)
- `goal_type` (TEXT, nullable) - 목표 종류 (completion_rate, streak_days, total_completions)
- `goal_value` (INTEGER, nullable) - 목표 값
- `target_time` (TIME, nullable) - 목표 수행 시간 (알림용)

**제약조건:**

- 사용자당 최대 습관 개수: 10개 (애플리케이션 레벨에서 체크)

### 11.2 RLS 정책 확장

- `user_stats`: 사용자는 자신의 통계만 조회/수정 가능
- `achievement_definitions`: 모든 사용자가 조회 가능 (공개), 관리자는 수정 가능
- `user_achievements`: 사용자는 자신의 업적만 조회 가능

### 11.3 배지 초기 데이터 예시

**achievement_definitions 테이블 초기 데이터:**

```sql
INSERT INTO achievement_definitions (code, name, description, icon_type, icon_value, condition_type, condition_value, display_order) VALUES
('badge_first_habit', '초보자', '첫 습관을 등록했습니다', 'emoji', '🎯', 'total_habits', 1, 1),
('badge_7days', '꾸준함', '7일 연속 달성했습니다', 'emoji', '🔥', 'streak_days', 7, 2),
('badge_30days', '불굴의 의지', '30일 연속 달성했습니다', 'emoji', '💪', 'streak_days', 30, 3),
('badge_100days', '장기 러너', '100일 연속 달성했습니다', 'emoji', '🏆', 'streak_days', 100, 4),
('badge_perfect_week', '주간 완벽주의자', '한 주 동안 모든 습관을 완료했습니다', 'emoji', '⭐', 'perfect_week', 1, 5),
('badge_perfect_month', '월간 완벽주의자', '한 달 동안 모든 습관을 완료했습니다', 'emoji', '👑', 'perfect_month', 1, 6),
('badge_10habits', '다작가', '습관 10개를 등록했습니다', 'emoji', '📚', 'total_habits', 10, 7),
('badge_100completions', '백전백승', '총 100번 완료했습니다', 'emoji', '💯', 'total_completions', 100, 8);
```

**배지 관리 방법:**

- 배지 추가: `achievement_definitions` 테이블에 INSERT
- 배지 수정: 조건 변경 시 `condition_value` 업데이트
- 배지 비활성화: `is_active = false` 설정 (기존 획득 기록은 유지)
- 배지 삭제: 비활성화 후 일정 기간 후 삭제 (또는 soft delete)

