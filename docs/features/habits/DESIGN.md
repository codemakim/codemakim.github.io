# 습관 관리 기능 설계 문서

> **참고**:
>
> - 프로젝트 아키텍처: `docs/ARCHITECTURE.md`
> - 데이터베이스 설계: `docs/features/habits/DATABASE.md`
> - 인증 시스템: `docs/features/habits/AUTH.md`
> - 프로젝트 로드맵: `docs/ROADMAP.md`

## 1. 프로젝트 개요

### 1.1 목표

기존 Flutter 앱 `doit_everyday`를 웹 버전으로 업그레이드하여 Next.js 블로그와 통합된 습관 관리 플랫폼 구축

### 1.2 핵심 개선사항

1. **클라우드 동기화**: Supabase를 통한 다기기 동기화
2. **웹 접근성**: 브라우저에서 접근 가능
3. **블로그 통합**: 랜딩 페이지에서 바로 접근
4. **향상된 UX**: 모던한 웹 UI/UX 적용

## 2. 기능 스펙

### 2.1 습관 등록 (`/habits/create`)

**입력 항목:**

- 제목 (필수, 텍스트)
- 설명 (선택, 텍스트)
- 시작일 (필수, 날짜)
- 종료일 (필수, 날짜)
- 수행 요일 (필수, 다중 선택: 월~일)
- 색상 (선택, 색상 피커)

**검증 규칙:**

- 제목: 1~50자
- 시작일 ≤ 종료일
- 최소 1개 요일 선택
- 종료일은 오늘부터 최대 3년 후까지

**UI 구성:**

- 폼 레이아웃 (카드 형태)
- 날짜 선택기
- 요일 체크박스 그리드
- 색상 선택 버튼
- 저장/취소 버튼

### 2.2 습관 목록 (`/habits`)

**디자인 철학:**

- 습관은 평생 지켜야 하는 것 → 너무 많이 만들지 않도록 유도
- 웹은 모바일보다 화면이 크지만, 집중력을 해치지 않아야 함
- 한 번에 하나만 보는 것보다 효율적이면서도 집중할 수 있는 균형 필요

**반응형 레이아웃:**

- 모바일 세로 (< 768px): 1열
- 모바일 가로 (< 768px): 2열
- 태블릿 (768px ~ 1024px): 2-3열
- 데스크톱 (> 1024px): 3-4열

**토글 기능: 체크 화면 ↔ 달력 뷰**

- 기본 화면: 습관 체크하기 (각 습관 카드에 완료 체크)
- 달력 뷰: 모든 습관의 종합 성공률을 날짜별로 표시
  - 각 날짜에 원형 파이차트로 성공률 표시
  - 성공률 계산: (완료된 습관 수 / 해당 날짜에 수행해야 할 습관 수) × 100

**각 습관 카드 구성:**

- 제목 (큰 글씨)
- 설명 (작은 글씨, 선택)
- 색상 인디케이터 (왼쪽 테두리 또는 배경)
- 완료 체크박스 (큰 버튼)
- 연속 달성 일수 (작은 배지: 🔥7)

**목록 표시 조건:**

습관 목록에는 **오늘 수행해야 할 습관만** 표시된다. 다음 3가지 조건을 모두 만족해야 함:

1. **오늘 요일이 습관의 수행 요일에 포함**: `habit.weekdays.includes(오늘요일)`
2. **오늘 날짜가 시작일 이후/같음**: `start_date <= 오늘`
3. **오늘 날짜가 종료일 이전/같음**: `end_date >= 오늘`

**인터랙션:**

- 카드 클릭 → 상세 페이지 이동
- 완료 체크박스 → 즉시 완료 처리
- 추가 버튼 → 등록 페이지 이동
- 토글 버튼 → 체크 화면 ↔ 달력 뷰 전환

**빈 상태:**

- 등록된 습관이 없을 때: "등록된 습관이 없습니다" + "첫 습관 만들기" 버튼
- 오늘 수행할 습관이 없을 때: "오늘 수행할 습관이 없습니다" + "달력으로 보기", "과거 습관 보기" 버튼

### 2.3 과거 습관 목록 (`/habits/archive`)

**목적**: 모든 습관의 통계를 한 화면에서 리뷰

**표시 조건:**

- 사용자의 **모든 습관**을 표시
  - 진행 중인 습관
  - 아직 시작 전인 습관
  - 종료일이 지난 습관(과거 습관)

**카드 구성 요소:**

1. **색상 인디케이터**: 왼쪽 테두리 또는 배경 (습관별 색상)
2. **제목**: 습관 제목 (큰 글씨)
3. **설명**: 습관 설명 (작은 글씨, 선택)
4. **상태 라벨**: 종료일이 지난 습관(`end_date < 오늘`)에는 카드 상단에 **"완료"** 라벨 표시
5. **통계 정보**:
   - 총 달성률: 완료율 퍼센트 (예: "75%")
   - 최대 연속 달성 일수: 최대 연속 달성 일수 (예: "최대 연속: 30일")
   - 총 완료 일수 / 총 일수: 구체적인 수치 (예: "45일 / 60일 완료")
   - 기간: 시작일 ~ 종료일 (예: "2025-01-01 ~ 2025-03-01")

**통계 계산:**

- 총 달성률: `(완료한 일수 / 총 일수) × 100`
- 총 일수: 습관 기간 내 수행해야 하는 날짜 수 (요일 필터링 적용)
- 완료한 일수: `habit_records`에서 `completed = true`인 레코드 수
- 최대 연속 달성 일수: 전체 기간 중 최대 연속으로 `completed = true`인 일수

**인터랙션:**

- 카드 클릭 → 상세 페이지 이동 (`/habits/detail?id=xxx`)
- 삭제 기능은 상세 페이지에서만 가능 (확인 모달 포함)

**레이아웃:**

- 모바일: 1열
- 데스크톱: 2열

**정렬:**

- 기본 정렬: 최신순 (종료일이 최근인 것부터)

### 2.4 습관 상세 (`/habits/detail?id=xxx`)

**표시 정보:**

- 습관 제목
- 기간 (시작일 ~ 종료일)
- 수행 요일
- 완료 횟수 / 총 일수
- 완료율 (%)
- 현재 연속 달성 일수 / 최대 연속 달성 일수
- 달력 뷰 (성공/실패 표시)

**액션:**

- 수정 버튼 → 수정 페이지 (`/habits/edit?id=xxx`)
- 삭제 버튼 → 확인 모달 후 삭제
- 달력에서 날짜 클릭 → 완료/미완료 토글

**달력 뷰 (해당 습관만):**

- 성공: 초록색 표시 또는 체크마크
- 실패: 회색 또는 X 표시
- 오늘: 강조 표시
- 미래 날짜: 비활성화

### 2.5 습관 수정 (`/habits/edit?id=xxx`)

**수정 가능 항목:**

- ✅ **제목** (title)
- ✅ **설명** (description)
- ✅ **색상** (color)

**수정 불가 항목 (데이터 무결성 보호):**

- ❌ **시작일** (start_date) - 기존 기록과 논리적 충돌 가능
- ❌ **종료일** (end_date) - 기존 기록과 논리적 충돌 가능
- ❌ **수행 요일** (weekdays) - 기존 기록과 논리적 불일치 발생

**설계 이유:**
기본 수정만 허용하는 이유는 기존 `habit_records` 테이블의 기록과 논리적 일관성을 유지하기 위함이다.

## 3. 화면 설계

### 3.1 디자인 원칙

**색상 시스템:**

- 그라데이션 제거 → 단색 + 미묘한 그림자
- Vercel 스타일: 순수 검은색/흰색 배경
- 습관별 색상: 사용자가 선택 (왼쪽 테두리 4px 또는 배경)
- 액센트 색상: 무채색 계열 (회색)로 통일

**모바일 터치 피드백:**

- 완료 체크 시: 스프링 애니메이션 (`scale(0.95)` → `scale(1.1)` → `scale(1)`)
- 카드 탭 시: 미묘한 눌림 효과 (`scale(0.98)`, 0.15s)
- 완료 시: 체크마크 그려지는 애니메이션 (SVG path animation, 0.3s)

**타이포그래피:**

- 제목: 큰 글씨 (모바일 24px, 데스크톱 32px)
- 설명: 작은 글씨 (14px)
- Geist 폰트 유지

**레이아웃:**

- 카드: 충분한 패딩 (모바일 24px, 데스크톱 32px)
- 여백: 충분한 공간 (카드 간 16-24px)
- 모바일 세로: 1열, 가로: 2열
- 태블릿: 2-3열
- 데스크톱: 3-4열

### 3.2 컴포넌트 구조

```
components/habits/
├── HabitsProvider.tsx          # 전역 캐시 관리
├── useHabits.ts                # 오늘 습관 필터링 훅
├── HabitCard.tsx               # 습관 카드 (목록)
├── PastHabitCard.tsx           # 과거 습관 카드 (아카이브)
├── HabitStats.tsx              # 통계 표시
├── HabitCalendar.tsx           # 개별 습관 달력
├── OverallCalendar.tsx         # 종합 달력 (모든 습관)
├── PageHeader.tsx              # 재사용 가능한 헤더
└── types.ts                    # 타입 정의
```

## 4. 데이터 처리

### 4.1 습관 데이터 흐름

- **HabitsProvider**: 전역 캐시 관리 (`Map<string, Habit>`)
- **useHabits**: 오늘 습관 필터링 (캐시에서 가져와서 필터링)
- **컴포넌트**: HabitsProvider 캐시 사용 필수, 직접 DB 호출 금지

> 상세 아키텍처: `docs/ARCHITECTURE.md` 참조

### 4.2 날짜 처리

- **YYYY-MM-DD 문자열 직접 사용** (타임존 문제 방지)
- `dateUtils.ts`의 `formatDateToYYYYMMDD`, `compareDateStrings` 사용
- `Date` 객체 비교 금지

### 4.3 통계 계산

- **유틸리티**: `lib/utils/habitStats.ts`
- 클라이언트 사이드에서 계산
- `habit_records`는 컴포넌트에서 필요 시 패칭

## 5. 참고 문서

- **데이터베이스 설계**: `docs/features/habits/DATABASE.md` - 테이블 구조, RLS 정책, SQL 스크립트
- **인증 시스템**: `docs/features/habits/AUTH.md` - 인증 플로우, 컴포넌트 구조
- **프로젝트 아키텍처**: `docs/ARCHITECTURE.md` - 코드 구조, 데이터 흐름, 주요 패턴
- **프로젝트 로드맵**: `docs/ROADMAP.md` - Phase별 작업, 현재 상태

## 6. 향후 기능 (계획)

### 6.1 게이미피케이션

- 스트릭 시각화 (연속 달성 체인)
- 배지/업적 시스템
- 레벨/경험치 시스템
- 목표 설정 및 달성률 추적

### 6.2 추가 기능

- 통계 대시보드
- 습관 템플릿
- 주간/월간 리포트
- 알림 기능
- 습관 공유 기능
- 필터/정렬 기능 (습관이 많아질 때)

> 상세 계획: `docs/ROADMAP.md` 참조
