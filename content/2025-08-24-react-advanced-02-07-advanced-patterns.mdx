---
title: "ğŸš€ [React ë¼ì´ë¸ŒëŸ¬ë¦¬ 7/8] React Query - ê³ ê¸‰ íŒ¨í„´"
date: "2025-08-25"
description: "Prefetching, Preloading, Query Keys ìµœì í™”"
tags: ["React", "ê³ ê¸‰", "í”„ë¡ íŠ¸ì—”ë“œ"]
series: "React ë¼ì´ë¸ŒëŸ¬ë¦¬"
seriesOrder: 52
---

# React Query ê°€ì´ë“œ - ê³ ê¸‰ íŒ¨í„´

> TanStack Query v5ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°ì´í„° í˜ì¹­ í•™ìŠµ ìë£Œ  
> ì¶œì²˜: [TanStack Query Documentation](https://tanstack.com/query/)

---

## ê³ ê¸‰ íŒ¨í„´
ê³ ê¸‰ íŒ¨í„´

ë¬´í•œ ìŠ¤í¬ë¡¤

### useInfiniteQuery

```jsx
import { useInfiniteQuery } from '@tanstack/react-query';

function Posts() {
  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    isLoading,
  } = useInfiniteQuery({
    queryKey: ['posts'],
    queryFn: ({ pageParam = 0 }) => fetchPosts(pageParam),
    getNextPageParam: (lastPage, allPages) => {
      // ë‹¤ìŒ í˜ì´ì§€ ë²ˆí˜¸ ë°˜í™˜
      return lastPage.nextCursor;
    },
    initialPageParam: 0,
  });

  if (isLoading) return <div>Loading...</div>;

  return (
    <div>
      {data.pages.map((page, i) => (
        <div key={i}>
          {page.posts.map(post => (
            <PostCard key={post.id} post={post} />
          ))}
        </div>
      ))}

      <button
        onClick={() => fetchNextPage()}
        disabled={!hasNextPage || isFetchingNextPage}
      >
        {isFetchingNextPage
          ? 'Loading more...'
          : hasNextPage
          ? 'Load More'
          : 'Nothing more to load'}
      </button>
    </div>
  );
}

async function fetchPosts(pageParam) {
  const response = await fetch(`/api/posts?cursor=${pageParam}`);
  return response.json();
}
```

### ìë™ ë¬´í•œ ìŠ¤í¬ë¡¤

```jsx
import { useInfiniteQuery } from '@tanstack/react-query';
import { useInView } from 'react-intersection-observer';

function Posts() {
  const { ref, inView } = useInView();

  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
  } = useInfiniteQuery({
    queryKey: ['posts'],
    queryFn: ({ pageParam = 0 }) => fetchPosts(pageParam),
    getNextPageParam: (lastPage) => lastPage.nextCursor,
    initialPageParam: 0,
  });

  // í™”ë©´ì— ë³´ì´ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ
  useEffect(() => {
    if (inView && hasNextPage) {
      fetchNextPage();
    }
  }, [inView, hasNextPage, fetchNextPage]);

  return (
    <div>
      {data?.pages.map((page, i) => (
        <div key={i}>
          {page.posts.map(post => (
            <PostCard key={post.id} post={post} />
          ))}
        </div>
      ))}

      {/* ê°ì§€ ì˜ì—­ */}
      <div ref={ref}>
        {isFetchingNextPage && <LoadingSpinner />}
      </div>
    </div>
  );
}
```

### ì–‘ë°©í–¥ ë¬´í•œ ìŠ¤í¬ë¡¤

```jsx
const {
  data,
  fetchNextPage,
  fetchPreviousPage,
  hasNextPage,
  hasPreviousPage,
} = useInfiniteQuery({
  queryKey: ['posts'],
  queryFn: ({ pageParam = 0 }) => fetchPosts(pageParam),
  getNextPageParam: (lastPage) => lastPage.nextCursor,
  getPreviousPageParam: (firstPage) => firstPage.previousCursor,
  initialPageParam: 0,
});
```

---