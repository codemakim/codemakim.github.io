---
title: "ğŸš€ [React ë¼ì´ë¸ŒëŸ¬ë¦¬ 3/8] React Query - ë®¤í…Œì´ì…˜"
date: "2025-08-21"
description: "useMutation, ë‚™ê´€ì  ì—…ë°ì´íŠ¸, ì—ëŸ¬ ì²˜ë¦¬"
tags: ["React", "ê³ ê¸‰", "í”„ë¡ íŠ¸ì—”ë“œ"]
series: "React ë¼ì´ë¸ŒëŸ¬ë¦¬"
seriesOrder: 48
---

# React Query ê°€ì´ë“œ - ë®¤í…Œì´ì…˜

> TanStack Query v5ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°ì´í„° í˜ì¹­ í•™ìŠµ ìë£Œ  
> ì¶œì²˜: [TanStack Query Documentation](https://tanstack.com/query/)

---

## ë®¤í…Œì´ì…˜
ë®¤í…Œì´ì…˜

ì¿¼ë¦¬ ê¸°ì´ˆ

### 1. useQuery ê¸°ë³¸

```jsx
import { useQuery } from '@tanstack/react-query';

function Users() {
  const { data, isLoading, error, isError } = useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers,
  });

  if (isLoading) return <div>Loading...</div>;
  if (isError) return <div>Error: {error.message}</div>;

  return (
    <ul>
      {data.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}

async function fetchUsers() {
  const response = await fetch('/api/users');
  if (!response.ok) {
    throw new Error('Failed to fetch users');
  }
  return response.json();
}
```

### 2. Query Key

**Query KeyëŠ” ì¿¼ë¦¬ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•©ë‹ˆë‹¤.**

```jsx
// ë‹¨ìˆœ í‚¤
useQuery({ queryKey: ['users'], queryFn: fetchUsers });

// íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ” í‚¤
useQuery({ 
  queryKey: ['user', userId], 
  queryFn: () => fetchUser(userId) 
});

// ë³µì¡í•œ í‚¤
useQuery({ 
  queryKey: ['users', { status: 'active', page: 1 }],
  queryFn: () => fetchUsers({ status: 'active', page: 1 })
});
```

### 3. Query Function

```jsx
// ê¸°ë³¸
const query = useQuery({
  queryKey: ['users'],
  queryFn: fetchUsers,
});

// í™”ì‚´í‘œ í•¨ìˆ˜
const query = useQuery({
  queryKey: ['users'],
  queryFn: () => fetch('/api/users').then(res => res.json()),
});

// async/await
const query = useQuery({
  queryKey: ['users'],
  queryFn: async () => {
    const response = await fetch('/api/users');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  },
});

// QueryKeyì—ì„œ ê°’ ì¶”ì¶œ
const query = useQuery({
  queryKey: ['user', userId],
  queryFn: ({ queryKey }) => {
    const [_key, userId] = queryKey;
    return fetchUser(userId);
  },
});
```

### 4. ìƒíƒœ ê´€ë¦¬

```jsx
function UserProfile({ userId }) {
  const { 
    data,           // ì¿¼ë¦¬ ë°ì´í„°
    error,          // ì—ëŸ¬ ê°ì²´
    isLoading,      // ì´ˆê¸° ë¡œë”© (ë°ì´í„° ì—†ìŒ + ë¡œë”© ì¤‘)
    isFetching,     // ë°±ê·¸ë¼ìš´ë“œ í˜ì¹­ ì¤‘
    isError,        // ì—ëŸ¬ ë°œìƒ
    isSuccess,      // ì„±ê³µ
    status,         // 'pending' | 'error' | 'success'
    fetchStatus,    // 'fetching' | 'paused' | 'idle'
  } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  // isLoading: ì²˜ìŒ ë¡œë”© ì¤‘ (ë°ì´í„° ì—†ìŒ)
  if (isLoading) return <Spinner />;

  // isError: ì—ëŸ¬ ë°œìƒ
  if (isError) return <ErrorMessage error={error} />;

  // isSuccess: ë°ì´í„° ë¡œë“œ ì™„ë£Œ
  return (
    <div>
      {/* isFetching: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¦¬í˜ì¹­ ì¤‘ */}
      {isFetching && <RefreshingIndicator />}
      <h1>{data.name}</h1>
      <p>{data.email}</p>
    </div>
  );
}
```

### 5. ì˜ì¡´ì  ì¿¼ë¦¬

```jsx
function UserPosts({ userId }) {
  // ë¨¼ì € ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const { data: user } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  // userê°€ ìˆì„ ë•Œë§Œ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
  const { data: posts } = useQuery({
    queryKey: ['posts', user?.id],
    queryFn: () => fetchPosts(user.id),
    enabled: !!user,  // userê°€ ìˆì„ ë•Œë§Œ ì‹¤í–‰
  });

  return (
    <div>
      <h1>{user?.name}'s Posts</h1>
      {posts?.map(post => (
        <Post key={post.id} {...post} />
      ))}
    </div>
  );
}
```

### 6. ë³‘ë ¬ ì¿¼ë¦¬

```jsx
function Dashboard() {
  const users = useQuery({ 
    queryKey: ['users'], 
    queryFn: fetchUsers 
  });
  
  const posts = useQuery({ 
    queryKey: ['posts'], 
    queryFn: fetchPosts 
  });
  
  const comments = useQuery({ 
    queryKey: ['comments'], 
    queryFn: fetchComments 
  });

  // ëª¨ë“  ì¿¼ë¦¬ê°€ ë¡œë”© ì¤‘ì¸ì§€ í™•ì¸
  if (users.isLoading || posts.isLoading || comments.isLoading) {
    return <div>Loading...</div>;
  }

  return (
    <div>
      <Users data={users.data} />
      <Posts data={posts.data} />
      <Comments data={comments.data} />
    </div>
  );
}
```

**useQueriesë¡œ ë™ì  ë³‘ë ¬ ì¿¼ë¦¬:**

```jsx
function UserProfiles({ userIds }) {
  const userQueries = useQueries({
    queries: userIds.map(id => ({
      queryKey: ['user', id],
      queryFn: () => fetchUser(id),
    })),
  });

  const isLoading = userQueries.some(query => query.isLoading);
  const isError = userQueries.some(query => query.isError);

  if (isLoading) return <div>Loading...</div>;
  if (isError) return <div>Error loading users</div>;

  return (
    <div>
      {userQueries.map((query, index) => (
        <UserCard key={userIds[index]} user={query.data} />
      ))}
    </div>
  );
}
```

---