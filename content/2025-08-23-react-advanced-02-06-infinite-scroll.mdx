---
title: "ğŸš€ [React ë¼ì´ë¸ŒëŸ¬ë¦¬ 6/8] React Query - ë¬´í•œ ìŠ¤í¬ë¡¤"
date: "2025-08-24"
description: "useInfiniteQueryë¡œ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„"
tags: ["React", "ê³ ê¸‰", "í”„ë¡ íŠ¸ì—”ë“œ"]
series: "React ë¼ì´ë¸ŒëŸ¬ë¦¬"
seriesOrder: 51
---

# React Query ê°€ì´ë“œ - ë¬´í•œ ìŠ¤í¬ë¡¤

> TanStack Query v5ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°ì´í„° í˜ì¹­ í•™ìŠµ ìë£Œ  
> ì¶œì²˜: [TanStack Query Documentation](https://tanstack.com/query/)

---

## ë¬´í•œ ìŠ¤í¬ë¡¤
ë¬´í•œ ìŠ¤í¬ë¡¤

ë‚™ê´€ì  ì—…ë°ì´íŠ¸

### ê¸°ë³¸ íŒ¨í„´

```jsx
function TodoList() {
  const queryClient = useQueryClient();

  const mutation = useMutation({
    mutationFn: updateTodo,
    onMutate: async (newTodo) => {
      // ì§„í–‰ ì¤‘ì¸ ë¦¬í˜ì¹˜ ì·¨ì†Œ
      await queryClient.cancelQueries({ queryKey: ['todos'] });

      // ì´ì „ ë°ì´í„° ìŠ¤ëƒ…ìƒ·
      const previousTodos = queryClient.getQueryData(['todos']);

      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
      queryClient.setQueryData(['todos'], (old) =>
        old.map(todo =>
          todo.id === newTodo.id ? newTodo : todo
        )
      );

      // ë¡¤ë°±ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ ë°˜í™˜
      return { previousTodos };
    },
    onError: (err, newTodo, context) => {
      // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡¤ë°±
      queryClient.setQueryData(['todos'], context.previousTodos);
      toast.error('Failed to update todo');
    },
    onSettled: () => {
      // ì„±ê³µ/ì‹¤íŒ¨ ìƒê´€ì—†ì´ ë¦¬í˜ì¹˜
      queryClient.invalidateQueries({ queryKey: ['todos'] });
    },
  });

  function handleToggle(todo) {
    mutation.mutate({
      ...todo,
      completed: !todo.completed,
    });
  }

  return (
    <div>
      {todos.map(todo => (
        <TodoItem
          key={todo.id}
          todo={todo}
          onToggle={handleToggle}
        />
      ))}
    </div>
  );
}
```

### ë³µì¡í•œ ì˜ˆì œ: ì¢‹ì•„ìš” ë²„íŠ¼

```jsx
function LikeButton({ postId }) {
  const queryClient = useQueryClient();

  const likeMutation = useMutation({
    mutationFn: (postId) => fetch(`/api/posts/${postId}/like`, { method: 'POST' }),
    onMutate: async (postId) => {
      await queryClient.cancelQueries({ queryKey: ['post', postId] });

      const previousPost = queryClient.getQueryData(['post', postId]);

      queryClient.setQueryData(['post', postId], (old) => ({
        ...old,
        likes: old.likes + 1,
        isLiked: true,
      }));

      return { previousPost };
    },
    onError: (err, postId, context) => {
      queryClient.setQueryData(['post', postId], context.previousPost);
    },
    onSettled: (data, error, postId) => {
      queryClient.invalidateQueries({ queryKey: ['post', postId] });
    },
  });

  const unlikeMutation = useMutation({
    mutationFn: (postId) => fetch(`/api/posts/${postId}/unlike`, { method: 'POST' }),
    onMutate: async (postId) => {
      await queryClient.cancelQueries({ queryKey: ['post', postId] });

      const previousPost = queryClient.getQueryData(['post', postId]);

      queryClient.setQueryData(['post', postId], (old) => ({
        ...old,
        likes: old.likes - 1,
        isLiked: false,
      }));

      return { previousPost };
    },
    onError: (err, postId, context) => {
      queryClient.setQueryData(['post', postId], context.previousPost);
    },
  });

  const { data: post } = useQuery({
    queryKey: ['post', postId],
    queryFn: () => fetchPost(postId),
  });

  function handleClick() {
    if (post.isLiked) {
      unlikeMutation.mutate(postId);
    } else {
      likeMutation.mutate(postId);
    }
  }

  return (
    <button onClick={handleClick}>
      {post.isLiked ? 'â¤ï¸' : 'ğŸ¤'} {post.likes}
    </button>
  );
}
```

---