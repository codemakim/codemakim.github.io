---
title: "ğŸš€ [React ë¼ì´ë¸ŒëŸ¬ë¦¬ 4/8] React Query - ìºì‹± ì „ëµ"
date: "2025-08-22"
description: "Stale Time, Cache Time, Query Invalidation"
tags: ["React", "ê³ ê¸‰", "í”„ë¡ íŠ¸ì—”ë“œ"]
series: "React ë¼ì´ë¸ŒëŸ¬ë¦¬"
seriesOrder: 49
---

# React Query ê°€ì´ë“œ - ìºì‹± ì „ëµ

> TanStack Query v5ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°ì´í„° í˜ì¹­ í•™ìŠµ ìë£Œ  
> ì¶œì²˜: [TanStack Query Documentation](https://tanstack.com/query/)

---

## ìºì‹± ì „ëµ
ìºì‹± ì „ëµ

ë®¤í…Œì´ì…˜

### 1. useMutation ê¸°ë³¸

```jsx
import { useMutation, useQueryClient } from '@tanstack/react-query';

function CreateUser() {
  const queryClient = useQueryClient();

  const mutation = useMutation({
    mutationFn: (newUser) => {
      return fetch('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newUser),
      }).then(res => res.json());
    },
    onSuccess: () => {
      // ì¿¼ë¦¬ ë¬´íš¨í™” (ë¦¬í˜ì¹˜ íŠ¸ë¦¬ê±°)
      queryClient.invalidateQueries({ queryKey: ['users'] });
    },
  });

  function handleSubmit(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    mutation.mutate({
      name: formData.get('name'),
      email: formData.get('email'),
    });
  }

  return (
    <form onSubmit={handleSubmit}>
      <input name="name" placeholder="Name" />
      <input name="email" placeholder="Email" />
      <button type="submit" disabled={mutation.isPending}>
        {mutation.isPending ? 'Creating...' : 'Create User'}
      </button>
      {mutation.isError && <div>Error: {mutation.error.message}</div>}
      {mutation.isSuccess && <div>User created!</div>}
    </form>
  );
}
```

### 2. ë®¤í…Œì´ì…˜ ìƒíƒœ

```jsx
function DeleteUser({ userId }) {
  const mutation = useMutation({
    mutationFn: (id) => fetch(`/api/users/${id}`, { method: 'DELETE' }),
  });

  const {
    mutate,         // ë®¤í…Œì´ì…˜ ì‹¤í–‰ í•¨ìˆ˜
    isPending,      // ì§„í–‰ ì¤‘
    isError,        // ì—ëŸ¬ ë°œìƒ
    isSuccess,      // ì„±ê³µ
    error,          // ì—ëŸ¬ ê°ì²´
    data,           // ì‘ë‹µ ë°ì´í„°
    reset,          // ìƒíƒœ ì´ˆê¸°í™”
  } = mutation;

  return (
    <div>
      <button onClick={() => mutate(userId)} disabled={isPending}>
        {isPending ? 'Deleting...' : 'Delete'}
      </button>
      
      {isError && <div>Error: {error.message}</div>}
      {isSuccess && <div>User deleted successfully!</div>}
      
      {(isError || isSuccess) && (
        <button onClick={reset}>Reset</button>
      )}
    </div>
  );
}
```

### 3. ë®¤í…Œì´ì…˜ ì½œë°±

```jsx
const mutation = useMutation({
  mutationFn: createUser,
  onMutate: async (newUser) => {
    // ë®¤í…Œì´ì…˜ ì‹œì‘ ì „
    console.log('Creating user:', newUser);
    
    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì´ì „ ë°ì´í„° ë°˜í™˜
    const previousUsers = queryClient.getQueryData(['users']);
    return { previousUsers };
  },
  onError: (error, variables, context) => {
    // ì—ëŸ¬ ë°œìƒ ì‹œ
    console.error('Error creating user:', error);
    
    // ë¡¤ë°±
    if (context?.previousUsers) {
      queryClient.setQueryData(['users'], context.previousUsers);
    }
  },
  onSuccess: (data, variables, context) => {
    // ì„±ê³µ ì‹œ
    console.log('User created:', data);
    toast.success('User created successfully!');
  },
  onSettled: (data, error, variables, context) => {
    // ì„±ê³µì´ë“  ì‹¤íŒ¨ë“  ì™„ë£Œ í›„
    queryClient.invalidateQueries({ queryKey: ['users'] });
  },
});
```

### 4. ì¿¼ë¦¬ ë¬´íš¨í™”

```jsx
const queryClient = useQueryClient();

// íŠ¹ì • ì¿¼ë¦¬ ë¬´íš¨í™”
queryClient.invalidateQueries({ queryKey: ['users'] });

// íŠ¹ì • ì‚¬ìš©ì ì¿¼ë¦¬ ë¬´íš¨í™”
queryClient.invalidateQueries({ queryKey: ['user', userId] });

// ì ‘ë‘ì‚¬ë¡œ ë¬´íš¨í™” (ëª¨ë“  user ê´€ë ¨ ì¿¼ë¦¬)
queryClient.invalidateQueries({ queryKey: ['user'] });

// ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ì¿¼ë¦¬ë§Œ ë¬´íš¨í™”
queryClient.invalidateQueries({ 
  queryKey: ['users'], 
  exact: true 
});
```

### 5. ìºì‹œ ì§ì ‘ ì—…ë°ì´íŠ¸

```jsx
const mutation = useMutation({
  mutationFn: createUser,
  onSuccess: (newUser) => {
    // ê¸°ì¡´ ìºì‹œ ê°€ì ¸ì˜¤ê¸°
    const previousUsers = queryClient.getQueryData(['users']);
    
    // ìƒˆ ì‚¬ìš©ì ì¶”ê°€
    queryClient.setQueryData(['users'], (old) => [...old, newUser]);
    
    // ë˜ëŠ” invalidateQueriesë¡œ ë¦¬í˜ì¹˜
    // queryClient.invalidateQueries({ queryKey: ['users'] });
  },
});
```

---